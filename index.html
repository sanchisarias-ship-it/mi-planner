<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mi Planner Saludable</title>
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family:-apple-system,BlinkMacSystemFont,Arial,sans-serif; margin:0; background:#f4f9ff; }
header { background:linear-gradient(135deg,#00c6ff,#0072ff); color:white; padding:12px; text-align:center; display:flex; align-items:center; justify-content:center; gap:12px;}
header img { width:48px; height:48px; border-radius:12px; }
nav { display:flex; background:#0d2b45; }
nav button { flex:1; padding:12px; border:none; background:#0d2b45; color:white; font-size:14px; }
nav button.active { background:#123e63; }
section { display:none; padding:14px; }
section.active { display:block; }
.card { background:white; padding:14px; border-radius:16px; margin-bottom:12px; box-shadow:0 4px 8px rgba(0,0,0,.06); }

li { list-style:none; display:flex; align-items:center; gap:8px; background:#f9fcff; padding:6px 10px; border-radius:10px; margin-bottom:6px; }
li span { flex:1; }
li.checked { text-decoration: line-through; background:#dffbe7; opacity:0.85; }

input, button, select { padding:10px; border-radius:10px; border:1px solid #ccc; font-size:15px; }
button.primary { background:#0072ff; color:white; border:none; }
button.danger { background:#ff4d4d; color:white; border:none; }
.small { font-size:13px; color:#666; }
</style>
</head>
<body>

<header>
  <img src="apple-touch-icon.png" alt="Icono">
  <h2>Mi Planner Saludable</h2>
</header>

<nav>
  <button class="active" onclick="showTab('hoy',this)">Hoy</button>
  <button onclick="showTab('calendario',this)">Calendario</button>
  <button onclick="showTab('alimentos',this)">Alimentos</button>
  <button onclick="showTab('compra',this)">Lista compra</button>
  <button onclick="showTab('seguimiento',this)">Seguimiento</button>
</nav>

<section id="hoy" class="active">
  <div class="card"><h3>Hoy</h3><p class="small">Vista activa</p></div>
</section>

<section id="calendario">
  <div class="card"><p class="small">Calendario activo</p></div>
</section>

<section id="alimentos">
  <div class="card">
    <h3>‚ûï A√±adir alimento</h3>
    <div style="display:flex; gap:6px; flex-wrap:wrap;">
      <input id="nuevoAlimento" placeholder="Ej: Aguacate">
      <select id="categoriaSelect"></select>
      <button class="primary" onclick="addFood()">A√±adir</button>
    </div>
    <p class="small">Marca alimentos para a√±adirlos a la lista de compra.</p>
  </div>
  <div class="card" id="foodContainer">Cargando alimentos...</div>
</section>

<section id="compra">
  <div class="card">
    <h3>üõí Lista de compra</h3>
    <p class="small">Marca los productos cuando los compres.</p>
    <button class="danger" onclick="vaciarLista()">Vaciar lista</button>
  </div>
  <div class="card" id="listaCompra">Sin productos seleccionados.</div>
</section>

<section id="seguimiento">
  <div class="card">
    <h3>Seguimiento activo</h3>
    <p class="small">Sin cambios.</p>
  </div>
</section>

<script>
let alimentosData = {};

function showTab(id,btn){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  btn.classList.add("active");
  if(id==="compra") renderCompra();
}

// -------- ALIMENTOS --------
async function loadFoods(){
  try{
    const local = localStorage.getItem("alimentosData");
    if(local){
      alimentosData = JSON.parse(local);
    } else {
      const res = await fetch("ALIMENTOS SALUDABLES.json");
      alimentosData = await res.json();
      localStorage.setItem("alimentosData", JSON.stringify(alimentosData));
    }
    renderFoods();
  }catch(e){
    document.getElementById("foodContainer").innerHTML = "No se pudieron cargar alimentos.";
  }
}

function renderFoods(){
  const cont = document.getElementById("foodContainer");
  const select = document.getElementById("categoriaSelect");
  cont.innerHTML=""; select.innerHTML="";
  const checks = JSON.parse(localStorage.getItem("foodChecks")||"{}");

  Object.keys(alimentosData).forEach(cat=>{
    select.innerHTML += `<option value="${cat}">${cat}</option>`;
    cont.innerHTML += `<h3>${cat}</h3>`;
    alimentosData[cat].forEach((item,i)=>{
      const key = cat+"_"+item;
      const marcado = checks[key];
      cont.innerHTML += `<li class="${marcado?'checked':''}">
        <input type="checkbox" ${marcado?'checked':''} onchange="toggleCheck('${key}')">
        <span>${item}</span>
        <button onclick="removeFood('${cat}',${i})">üóëÔ∏è</button>
      </li>`;
    });
  });
}

function toggleCheck(key){
  let checks = JSON.parse(localStorage.getItem("foodChecks")||"{}");
  checks[key] = !checks[key];
  localStorage.setItem("foodChecks", JSON.stringify(checks));
  renderFoods();
  renderCompra();
}

function addFood(){
  const name = document.getElementById("nuevoAlimento").value.trim();
  const cat = document.getElementById("categoriaSelect").value;
  if(!name) return alert("Introduce un alimento");
  alimentosData[cat].push(name);
  localStorage.setItem("alimentosData", JSON.stringify(alimentosData));
  document.getElementById("nuevoAlimento").value="";
  renderFoods();
}

function removeFood(cat,index){
  alimentosData[cat].splice(index,1);
  localStorage.setItem("alimentosData", JSON.stringify(alimentosData));
  renderFoods();
  renderCompra();
}

// -------- LISTA COMPRA --------
function renderCompra(){
  const cont = document.getElementById("listaCompra");
  const checks = JSON.parse(localStorage.getItem("foodChecks")||"{}");
  const purchase = JSON.parse(localStorage.getItem("purchaseChecks")||"{}");

  const items = Object.keys(checks).filter(k=>checks[k]);

  if(items.length===0){
    cont.innerHTML = "No has marcado ning√∫n alimento todav√≠a.";
    return;
  }

  cont.innerHTML = "";
  items.forEach(k=>{
    const name = k.split("_").slice(1).join("_");
    const comprado = purchase[k];
    cont.innerHTML += `<li class="${comprado?'checked':''}">
      <input type="checkbox" ${comprado?'checked':''} onchange="togglePurchased('${k}')">
      <span>${name}</span>
    </li>`;
  });
}

function togglePurchased(key){
  let purchase = JSON.parse(localStorage.getItem("purchaseChecks")||"{}");
  purchase[key] = !purchase[key];
  localStorage.setItem("purchaseChecks", JSON.stringify(purchase));
  renderCompra();
}

function vaciarLista(){
  if(confirm("¬øSeguro que quieres vaciar la lista de compra?")){
    localStorage.removeItem("foodChecks");
    localStorage.removeItem("purchaseChecks");
    renderFoods();
    renderCompra();
  }
}

loadFoods();
</script>
</body>
</html>
